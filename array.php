<?php

$json = '{"data":[{"year":2019,"province":[{"pid":54,"type":[2],"batch":[10]},{"pid":33,"type":[3],"batch":[17,18]},{"pid":53,"type":[1,2],"batch":[7,10]},{"pid":22,"type":[1,2],"batch":[7,10]},{"pid":46,"type":[1,2],"batch":[14,11,10]},{"pid":23,"type":[1,2],"batch":[7]},{"pid":12,"type":[1,2],"batch":[14]},{"pid":44,"type":[1,2],"batch":[14,11,10]},{"pid":21,"type":[1,2],"batch":[14]},{"pid":50,"type":[1,2],"batch":[7,10]},{"pid":62,"type":[1,2],"batch":[7,10]},{"pid":51,"type":[1,2],"batch":[7,10]},{"pid":13,"type":[1,2],"batch":[7,10]},{"pid":15,"type":[1,2],"batch":[7,10]},{"pid":42,"type":[1,2],"batch":[7,10]},{"pid":65,"type":[1,2],"batch":[7,11,10]},{"pid":34,"type":[1,2],"batch":[7,10]},{"pid":41,"type":[1,2],"batch":[7,10]},{"pid":61,"type":[1,2],"batch":[7,10]},{"pid":43,"type":[1,2],"batch":[7,11,10]},{"pid":52,"type":[1,2],"batch":[7,10]},{"pid":37,"type":[1,2],"batch":[14,10]},{"pid":36,"type":[1,2],"batch":[7,10]},{"pid":64,"type":[1,2],"batch":[7,10]},{"pid":63,"type":[1,2],"batch":[7,10]},{"pid":14,"type":[1,2],"batch":[10,51]},{"pid":35,"type":[1,2],"batch":[7,10]},{"pid":45,"type":[1,2],"batch":[7,11,10]},{"pid":11,"type":[1,2],"batch":[14]},{"pid":32,"type":[1,2],"batch":[177]}]},{"year":2018,"province":[{"pid":33,"type":[3],"batch":[16]},{"pid":65,"type":[1,2],"batch":[7]},{"pid":64,"type":[1,2],"batch":[7]},{"pid":63,"type":[1,2],"batch":[7]},{"pid":62,"type":[1,2],"batch":[7]},{"pid":61,"type":[1,2],"batch":[7]},{"pid":53,"type":[1,2],"batch":[7]},{"pid":52,"type":[1,2],"batch":[6,7]},{"pid":51,"type":[1,2],"batch":[7]},{"pid":50,"type":[1,2],"batch":[6,7,12]},{"pid":46,"type":[1,2],"batch":[14,12]},{"pid":45,"type":[1,2],"batch":[7]},{"pid":44,"type":[1,2],"batch":[14]},{"pid":43,"type":[1,2],"batch":[7]},{"pid":42,"type":[1,2],"batch":[7]},{"pid":41,"type":[1,2],"batch":[7]},{"pid":37,"type":[1,2],"batch":[14]},{"pid":36,"type":[1,2],"batch":[7]},{"pid":35,"type":[1,2],"batch":[7]},{"pid":34,"type":[1,2],"batch":[7]},{"pid":32,"type":[1,2],"batch":[7]},{"pid":23,"type":[1,2],"batch":[7]},{"pid":22,"type":[1,2],"batch":[7]},{"pid":21,"type":[1,2],"batch":[14]},{"pid":15,"type":[1,2],"batch":[7]},{"pid":14,"type":[1,2],"batch":[7]},{"pid":13,"type":[1,2],"batch":[7]},{"pid":12,"type":[1,2],"batch":[14]},{"pid":11,"type":[1,2],"batch":[7]},{"pid":31,"type":[3],"batch":[14]}]},{"year":2017,"province":[{"pid":15,"type":[1,2],"batch":[7]},{"pid":21,"type":[1,2],"batch":[7]},{"pid":13,"type":[1,2],"batch":[7]},{"pid":64,"type":[1,2],"batch":[7]},{"pid":41,"type":[1,2],"batch":[7]},{"pid":37,"type":[1,2],"batch":[14]},{"pid":22,"type":[1,2],"batch":[7]},{"pid":42,"type":[1,2],"batch":[7]},{"pid":36,"type":[1,2],"batch":[7]},{"pid":52,"type":[1,2],"batch":[7]},{"pid":35,"type":[1,2],"batch":[6,7]},{"pid":51,"type":[1,2],"batch":[7]},{"pid":23,"type":[1,2],"batch":[7,51]},{"pid":31,"type":[3],"batch":[14]},{"pid":63,"type":[1,2],"batch":[7]},{"pid":14,"type":[1,2],"batch":[7,51]},{"pid":34,"type":[1,2],"batch":[7]},{"pid":12,"type":[1,2],"batch":[7]},{"pid":46,"type":[1,2],"batch":[14]},{"pid":65,"type":[1,2],"batch":[7]},{"pid":53,"type":[1,2],"batch":[7]},{"pid":43,"type":[1,2],"batch":[7]},{"pid":61,"type":[1,2],"batch":[7]},{"pid":45,"type":[1,2],"batch":[7]},{"pid":11,"type":[1,2],"batch":[6,7]},{"pid":62,"type":[1,2],"batch":[7]},{"pid":44,"type":[1,2],"batch":[7]},{"pid":32,"type":[1,2],"batch":[7]},{"pid":50,"type":[1,2],"batch":[7]}]},{"year":2016,"province":[{"pid":37,"type":[1,2],"batch":[7]},{"pid":54,"type":[1,2],"batch":[6,7]},{"pid":31,"type":[1,2],"batch":[7]},{"pid":15,"type":[1,2],"batch":[7]},{"pid":50,"type":[1,2],"batch":[7]},{"pid":64,"type":[1,2],"batch":[7]},{"pid":13,"type":[1,2],"batch":[6,7]},{"pid":22,"type":[1,2],"batch":[7]},{"pid":44,"type":[1,2],"batch":[6,7]},{"pid":21,"type":[1,2],"batch":[7]},{"pid":35,"type":[1,2],"batch":[6,7]},{"pid":32,"type":[1,2],"batch":[6,7]},{"pid":61,"type":[1,2],"batch":[6,7]},{"pid":36,"type":[1,2],"batch":[6,7]},{"pid":52,"type":[1,2],"batch":[6,7]},{"pid":23,"type":[1,2],"batch":[6,7]},{"pid":62,"type":[1,2],"batch":[7]},{"pid":42,"type":[1,2],"batch":[6,7]},{"pid":11,"type":[1,2],"batch":[6,7,8]},{"pid":14,"type":[1,2],"batch":[6,7]},{"pid":63,"type":[1,2],"batch":[7]},{"pid":34,"type":[1,2],"batch":[6,7]},{"pid":33,"type":[1,2],"batch":[7]},{"pid":46,"type":[1,2],"batch":[7]},{"pid":45,"type":[1,2],"batch":[6,7]},{"pid":51,"type":[1,2],"batch":[6,7]},{"pid":12,"type":[1,2],"batch":[6,7]},{"pid":41,"type":[1,2],"batch":[6,7]},{"pid":43,"type":[1,2],"batch":[6,7]},{"pid":65,"type":[1,2],"batch":[7]},{"pid":53,"type":[1,2],"batch":[6,7]}]},{"year":2015,"province":[{"pid":23,"type":[1,2],"batch":[7]},{"pid":15,"type":[1,2],"batch":[7]},{"pid":11,"type":[1,2],"batch":[7,8]},{"pid":36,"type":[1,2],"batch":[7]},{"pid":44,"type":[1,2],"batch":[7]},{"pid":31,"type":[1,2],"batch":[7]},{"pid":34,"type":[1,2],"batch":[7]},{"pid":32,"type":[1,2],"batch":[7]},{"pid":63,"type":[1,2],"batch":[7]},{"pid":46,"type":[1,2],"batch":[7]},{"pid":61,"type":[1,2],"batch":[7]},{"pid":52,"type":[1,2],"batch":[7]},{"pid":65,"type":[1,2],"batch":[7]},{"pid":64,"type":[1,2],"batch":[7]},{"pid":21,"type":[1,2],"batch":[7]},{"pid":45,"type":[1,2],"batch":[7]},{"pid":53,"type":[1,2],"batch":[7]},{"pid":42,"type":[1,2],"batch":[7]},{"pid":62,"type":[1,2],"batch":[7]},{"pid":43,"type":[1,2],"batch":[7]},{"pid":22,"type":[1,2],"batch":[7]},{"pid":13,"type":[1,2],"batch":[7]},{"pid":35,"type":[1,2],"batch":[7]},{"pid":41,"type":[1,2],"batch":[7]},{"pid":12,"type":[1,2],"batch":[7]},{"pid":37,"type":[1,2],"batch":[7]},{"pid":51,"type":[1,2],"batch":[7]},{"pid":50,"type":[1,2],"batch":[7]}]},{"year":2014,"province":[{"pid":65,"type":[1,2],"batch":[7]},{"pid":64,"type":[1,2],"batch":[7]},{"pid":63,"type":[1,2],"batch":[7]},{"pid":62,"type":[1,2],"batch":[7]},{"pid":61,"type":[1,2],"batch":[6,7]},{"pid":54,"type":[1,2],"batch":[6]},{"pid":53,"type":[1,2],"batch":[7]},{"pid":52,"type":[1,2],"batch":[6,7]},{"pid":51,"type":[1,2],"batch":[6,7]},{"pid":50,"type":[1,2],"batch":[6,7]},{"pid":46,"type":[1,2],"batch":[7]},{"pid":45,"type":[1,2],"batch":[6,7]},{"pid":44,"type":[1,2],"batch":[6,7]},{"pid":43,"type":[1,2],"batch":[6,7]},{"pid":42,"type":[1,2],"batch":[6,7]},{"pid":41,"type":[1,2],"batch":[6,7]},{"pid":37,"type":[1,2],"batch":[6,7]},{"pid":36,"type":[1,2],"batch":[6,7]},{"pid":35,"type":[1,2],"batch":[6,7]},{"pid":34,"type":[1,2],"batch":[6,7]},{"pid":33,"type":[1,2],"batch":[6,7]},{"pid":32,"type":[1,2],"batch":[6,7]},{"pid":31,"type":[1,2],"batch":[7]},{"pid":23,"type":[1,2],"batch":[7]},{"pid":22,"type":[1,2],"batch":[6,7]},{"pid":21,"type":[1,2],"batch":[7]},{"pid":15,"type":[1,2],"batch":[7]},{"pid":14,"type":[1,2],"batch":[6,7]},{"pid":13,"type":[1,2],"batch":[6,7]},{"pid":12,"type":[1,2],"batch":[6,7]},{"pid":11,"type":[1,2],"batch":[6,7]}]}],"year":[2019,2018,2017,2016,2015,2014],"pids":[11,12,13,14,15,21,22,23,31,32,33,34,35,36,37,41,42,43,44,45,46,50,51,52,53,54,61,62,63,64,65]}';

$array = json_decode($json, true);
$array = $array['data'];

// 这不是6年吗，根据每个年里面的相同pid把type合并

// 取所有的pid和type
$pidArray = [];
foreach ($array as $key => $value) {
    $province = $value['province'];
    foreach ($province as $k => $v) {
        $temp = [];
        $temp['pid'] = $v['pid'];
        $temp['type'] = $v['type'];
        array_push($pidArray, $temp);
    }
}


// 把pid相同的type放到一个数组
$res = [];
foreach($pidArray as $v){
    $res[$v['pid']][]=$v['type'];
}


// 把整合好的type合并
$result = [];
$i = 0;
foreach ($res as $k => $v) {
    $temp = [];
    foreach ($v as $type) {
        $temp = array_merge($temp, $type);
    }

    $result[$i]['pid'] = $k;
    $result[$i]['type'] = $temp;
    $i++;
}

var_dump($result);